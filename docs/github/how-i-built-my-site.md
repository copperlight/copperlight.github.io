# How I Built My Site

<div class="meta">
  <span class="date"><small>2017-10-12</small></span>
  <span class="discuss"><a class="github-button" href="https://github.com/copperlight/copperlight.github.io/issues" data-icon="octicon-issue-opened" aria-label="Discuss copperlight/copperlight.github.io on GitHub">Discuss</a></span>
</div><br/>

I recently rebuilt my GitHub Pages site, switching my tech stack to [Python], [MkDocs] and
[Material for MkDocs]. The previous workflow had too many moving parts and the theme was hard to
read.  It turns out that MkDocs has some nice automation hooks for GitHub Pages and it looks great
on mobile browsers with the [Material] theme. Since I use MkDocs for site generation at work, I am
already pretty familiar with it.

Writing documents in [Markdown] and turning them into web pages with a static site generator is the
fastest and easiest way to post articles on your GitHub Pages site.  This format allows you to
drop down into HTML, when necessary, to enhance your page formatting, but you shouldn't need to do
this for most pages.

[Material]: https://material.io/
[Material for MkDocs]: http://squidfunk.github.io/mkdocs-material/
[MkDocs]: http://www.mkdocs.org/
[Python]: https://www.python.org/
[Markdown]: https://daringfireball.net/projects/markdown/syntax

## Install Python and MkDocs Packages

If you are relying on a system Python, consider following these instructions:
[Install the Latest Python Versions on Mac OSX].

Install [MkDocs] and [Material for MkDocs]. These two packages will bring along all of the necessary
dependencies for a fully functioning site.

```bash
pip install mkdocs mkdocs-material
```

[Install the Latest Python Versions on Mac OSX]: ../python/install-the-latest-python-versions-on-macosx.md

## Sign Up for Google Analytics

!!! note
    You must disable ad-blocking software in order to be able to see the Google Analytics page.

1. Navigate to [Google Analytics](https://analytics.google.com/analytics/web/) > Admin
1. Property > Create New Property
    1. **Account Name:** $YOUR_ACCOUNT_NAME
    1. **Website Name:** username.github.io
    1. **Website URL:** https://username.github.io
    1. Go with the default configuration options - you can change these later.
    1. Get Tracking ID
1. Note the Tracking ID (looks like: `UA-00000000-0`) assigned to this property.

## Build the Site

1. [Create a new repository](https://github.com/new) named `username.github.io`, where `username` is
your username (or organization name) on GitHub.  It must match exactly, or it will not work.

1. Clone the repository locally.  Requires [SSH keys](https://help.github.com/articles/connecting-to-github-with-ssh/).

        git clone git@github.com:username/username.github.io.git
        cd username.github.com

1. Create a new branch to store the source files for the site.  In this configuration, GitHub Pages
will be served from the `master` branch, which will contain the the static site generated by MkDocs.
To keep the `master` branch clean and avoid file conflicts, the source for the site will be stored
in the `source` branch.

        git checkout -b source

1. You will create a directory structure that looks like the following:

        username.github.io/
        ├── .gitignore
        ├── docs
        │   ├── css
        │   │   └── custom.css
        │   └── index.md
        ├── mkdocs.yml
        └── requirements.txt

1. Create a `./mkdocs.yml` site configuration file. Setting the `remote_branch` to `master` is
important for the GitHub deployment hooks in MkDocs. Choose a
[Creative Commons license](https://creativecommons.org/choose/) for your site - I chose
[CC BY-NC-SA 4.0](http://creativecommons.org/licenses/by-nc-sa/4.0/) for my site.  Add your Google
Analytics property Tracking ID to `google_analytics`.  If you do not have a Tracking ID, then delete this
line in the configuration file.

        site_name: My Site
        site_url: 'http://username.github.io/'
        repo_url: 'https://github.com/username/username.github.io'
        edit_uri: ''
        site_description: My Site
        site_author: My Name
        copyright: <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
        google_analytics: ['UA-00000000-0', 'username.github.io']
        remote_branch: master

        strict: True

        pages:
        - Home: index.md

        theme: material

        extra:
          font:
            code: 'Menlo'

        extra_css:
        - css/custom.css

        markdown_extensions:
        - admonition
        - codehilite
        - pymdownx.tilde
        - toc:
            permalink: True

1. Create a `./docs/index.md` file.

        Hello World!

1. Create a `./docs/css/custom.css` file.

        /* Avoid showing first header, i.e., the page title in the sidebar.
         *
         * https://github.com/mkdocs/mkdocs/issues/318#issuecomment-98520139
         */
        li.toctree-l3:first-child {
          display: none;
        }

        code {
          font-family: Menlo, monospace;
        }

1. Create a `./requirements.txt` file, so that you can easily reinstall the necessary Python packages
with `pip install -r requirements.txt`.

        mkdocs
        mkdocs-material

1. Create a `./.gitignore` file.

        site

1. Build and serve the site locally, to verify that your changes look good.  When MkDocs is up and
running, you will see `Serving on http://127.0.0.1:8000`. Leave this process running. When you are
done developing and testing your site, you can stop this process with `ctrl+c`. Open a new Terminal
to run the second command.

        mkdocs serve
        open http://localhost:8000

1. Push the source branch to GitHub to save your changes. You only need to set the upstream for the
first push; subsequent pushes will be `git push origin` as long as you remain on the `source` branch.

        git add --all
        git commit -m "first commit"
        git push --set-upstream origin source

1. Build and deploy the site. The static HTML site generated by this process will be pushed to the
`master` branch origin for this repository. Changes will be live within one minute. Navigate to
the site url to see your changes.

        mkdocs gh-deploy

## Repo Configuration

Navigate to the repository on GitHub and set some useful configuration options.

1. Code > Description
1. Code > Website
1. Code > Manage topics
1. Settings > Branches > Default branch: `source`
1. Settings > Branches > Protected branches: `source`
    1. Check: Protect this branch
    1. Check: Include administrators

## New Post Workflow

1. Start serving the site locally, with file change detection.

        mkdocs serve
        open http://localhost:8000

1. Start a new post by creating a markdown file in the `./docs` directory hierarchy.

1. Images can be served from a location such as `./docs/images`, with references as follows:

        ![Link Name](/images/my-file.png "Alt Text")

1. Add the new markdown file to the `./mkdocs.yml` site configuration and continue editing. See
[Writing Your Docs](http://www.mkdocs.org/user-guide/writing-your-docs/) for tips on arranging
your Markdown files.

1. When editing is complete, commit and push the file to save your work.

        git add --all
        git commit -m "my new post"
        git push origin

1. Build and deploy the site, which uses the `remote_branch` key from the `mkdocs.yml` file to
choose the branch that will receive the push. 

        mkdocs gh-deploy
